[meta]
name = "Image Prompt Generation"
description = "A blueprint for generating scripts using AI."
id = "ImagePromptGeneration"
version = "0.1.0"
author = "Tutopanda"
license = "MIT"

[[inputs]]
name = "NarrativeText"
description = "The narrative text to generate images based on."
type = "array"
cardinality = "perSegment"
itemType = "string"
required = true

[[inputs]]
name = "NumOfImagesPerNarrative"
description = "Number of images to generate per narrative text."
type = "int"
cardinality = "single"
required = false
default = 1

[[inputs]]
name = "OverallSummary"
description = "The overall summary that gives broader context."
type = "string"
cardinality = "single"
required = true

[[inputs]]
name = "ImageStyle"
description = "Image style to be taken into account"
type = "string"
cardinality = "single"
required = true

[[inputs]]
name = "Audience"
description = "The intended audience"
type = "string"
cardinality = "single"
required = false
default = "adult"

[[outputs]]
name = "ImagePrompt"
description = "The generated image prompts."
type = "array"
cardinality = "perSegment"

[graph]
nodes = [
    { inputRef = "NarrativeText", cardinality = "perSegment" },
    { inputRef = "ImageStyle", cardinality = "single" },
    { inputRef = "OverallSummary", cardinality = "single" },
    { inputRef = "Audience", cardinality = "single" },
    { inputRef = "NumOfImagesPerNarrative", cardinality = "single" },
    { producerRef = "ImagePromptProducer", cardinality = "perSegment"},
    { outputRef = "ImagePrompt", cardinality = "perSegment" }
]
edges = [
    { from = "NarrativeText", to = "ImagePromptProducer", perSegment = true },
    { from = "ImageStyle", to = "ImagePromptProducer" },
    { from = "OverallSummary", to = "ImagePromptProducer" },
    { from = "Audience", to = "ImagePromptProducer" },
    { from = "NumOfImagesPerNarrative", to = "ImagePromptProducer" },
    { from = "ImagePromptProducer", to = "ImagePrompt", perSegment = true }
]

[[producers]]
name = "ImagePromptProducer"
provider = "openai"
model = "gpt-5-mini"
settings = { temperature = 0.7, max_tokens = 1500 }
textFormat = "json_schema"
jsonSchema = """
{
  "schema": {
    "type": "object",
    "properties": {
      "imagePrompt": {
        "type": "array",
        "description": "Provide an image prompt for the image generator per segment.",
        "items": { "type": "string" }
      }
    },
    "required": ["imagePrompt"],
    "additionalProperties": false
  }
}
"""
variables = ["NarrativeText","ImageStyle","Audience","NumOfImagesPerNarrative", "OverallSummary"]
systemPrompt = """
You are an expert documentary filmmaker choosing a single compelling scene that illustrates the key point in a narrative.
You will be given the narrative text, intended audience and a desired image style. 
Use the narrative text to craft a prompt that highlights the core idea for an image generation model.
In your prompt make sure to incorporate the desired image style and also tailor the image for the intended audience.
The image will be produced by a diffusion model; do not instruct it to render any text or lettering.
Focus on one or two essential details so the scene remains clear and uncluttered.
The resulting scene should deliver the primary idea with clarity and emotional resonance.
"""
userPrompt = """
You are given this narrative text:
{{NarrativeText}}
The audience is specified as:
{{Audience}}
The overall summary of the movie is:
{{OverallSummary}}
The image style is:
{{ImageStyle}}
Generate exactly {{NumOfImagesPerNarrative}} distinct image prompts. Each prompt should capture a different key moment or aspect from the narrative.
"""
